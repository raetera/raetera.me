---
import Section from "../Section.astro";
import { work } from "@cv";
import CollapseText from "../CollapseText";
---

<Section className={Astro.props.className} title="Experience">
  <ul class="flex flex-col space-y-8 print:space-y-4">
    {
      work.map(
        ({
          name,
          startDate,
          endDate,
          position,
          summary,
          responsibilities,
          achievements,
          url,
          location,
          location_type,
        }) => {
          const startYear = new Date(startDate).getFullYear();
          const endYear = endDate ? new Date(endDate).getFullYear() : "Present";

          return (
            <li class="relative print:py-2">
              <div class="group relative grid gap-4 pb-1 transition-all sm:grid-cols-8 sm:gap-8 md:gap-4 lg:hover:!opacity-100 print:grid-cols-8 print:gap-4">
                <header class="relative mt-1 flex items-center text-xs font-semibold text-neutral-500 sm:col-span-2">
                  <time datetime={startDate}>{startYear}</time>
                  <span class="mx-1">-</span>
                  <time datetime={endDate}>{endYear}</time>
                </header>
                <div class="relative flex flex-col sm:col-span-6">
                  <h3 class="text-base font-medium leading-snug text-neutral-200">
                    <div class="inline-flex items-center">
                      <span>{position}</span>
                      <span class="mx-1.5">@</span>
                      {url ? (
                        <a
                          class="group inline-flex items-center text-neutral-200 hover:text-neutral-300 focus-visible:text-neutral-300"
                          href={url}
                          target="_blank"
                          rel="noopener noreferrer"
                        >
                          {name}
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                            class="ml-1 inline-block h-4 w-4 shrink-0 translate-y-px transition-transform group-hover/link:-translate-y-1 group-hover/link:translate-x-1 group-focus-visible/link:-translate-y-1 group-focus-visible/link:translate-x-1 motion-reduce:transition-none"
                            aria-hidden="true"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z"
                              clip-rule="evenodd"
                            />
                          </svg>
                        </a>
                      ) : (
                        <span>{name}</span>
                      )}
                    </div>
                  </h3>
                  {(location || location_type) && (
                    <p class="mt-1 text-sm text-neutral-400">
                      {location}
                      {location && location_type && " - "}
                      {location_type}
                    </p>
                  )}
                  <div class="mt-2 flex flex-col gap-4 text-sm">
                    {summary && (
                      <div class="flex flex-col gap-2">
                        <h4 class="font-medium text-neutral-300">Summary:</h4>
                        <ul class="list-inside list-disc space-y-1 text-neutral-400">
                          {Array.isArray(summary) ? (
                            summary.map((item) => <li>{item}</li>)
                          ) : (
                            <li>{summary}</li>
                          )}
                        </ul>
                      </div>
                    )}

                    {(responsibilities || achievements) && (
                      <CollapseText client:load>
                        {responsibilities && (
                          <div class="flex flex-col gap-2">
                            <h4 class="font-medium text-neutral-300">
                              Responsibilities:
                            </h4>
                            <ul class="list-inside list-disc space-y-1 text-neutral-400">
                              {responsibilities.map((responsibility) => (
                                <li>{responsibility}</li>
                              ))}
                            </ul>
                          </div>
                        )}

                        {achievements && (
                          <div class="flex flex-col gap-2">
                            <h4 class="font-medium text-neutral-300">
                              Achievements:
                            </h4>
                            <ul class="list-inside list-disc space-y-1 text-neutral-400">
                              {achievements.map((achievement) => (
                                <li>{achievement}</li>
                              ))}
                            </ul>
                          </div>
                        )}
                      </CollapseText>
                    )}
                  </div>
                </div>
              </div>
            </li>
          );
        }
      )
    }
  </ul>
</Section>
